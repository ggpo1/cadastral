{"version":3,"file":"static/js/2271.4036e5fd.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/2d/layers/graphics/HighlightGraphicContainer.js","../node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js","../node_modules/@arcgis/core/views/layers/MapImageLayerView.js","../node_modules/@arcgis/core/views/support/drapedUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/set.js\";import{subclass as e}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{WGLDrawPhase as s}from\"../../engine/webgl/enums.js\";import t from\"./BaseGraphicContainer.js\";let o=class extends t{renderChildren(r){if(r.drawPhase!==s.HIGHLIGHT)return;if(this.attributeView.bindTextures(r.context),!this.children.some((r=>r.hasData)))return;super.renderChildren(r);const{painter:e}=r,t=e.effects.highlight;t.bind(r),r.context.setColorMask(!0,!0,!0,!0),r.context.clear(16384),this._renderChildren(r,t.defines.concat([\"highlightAll\"])),t.draw(r),t.unbind()}};o=r([e(\"esri.views.2d.layers.support.HighlightGraphicContainer\")],o);const i=o;export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Logger.js\";import{isAbortError as r}from\"../../../core/promiseUtils.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{GraphicsCollection as a}from\"../../../support/GraphicsCollection.js\";import{BitmapContainer as o}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as h}from\"./LayerView2D.js\";import p from\"./graphics/GraphicsView2D.js\";import m from\"./graphics/HighlightGraphicContainer.js\";import n from\"./support/ExportStrategy.js\";import c from\"../../layers/LayerView.js\";import{MapImageLayerView as d}from\"../../layers/MapImageLayerView.js\";import{RefreshableLayerView as g}from\"../../layers/RefreshableLayerView.js\";import{createQueryGeometry as l}from\"../../support/drapedUtils.js\";const u=t.getLogger(\"esri.views.2d.layers.MapImageLayerView2D\");let f=class extends(d(g(h(c)))){constructor(){super(...arguments),this._highlightGraphics=new a}update(e){this.strategy.update(e).catch((e=>{r(e)||u.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:r}=this.layer,i=r>=10.3,s=r>=10;this._bitmapContainer=new o,this.container.addChild(this._bitmapContainer);const a=new p({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new m(this.view.featuresTilingScheme)});this.container.addChild(a.container),this.strategy=new n({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.handles.add(this.watch(\"exportImageVersion\",(()=>this.requestUpdate())),\"exportImageVersion\"),this.handles.add(this.watch(\"view.floors\",(()=>this.requestUpdate())),\"view.floors\"),this.requestUpdate()}detach(){this.handles.remove(\"exportImageVersion\"),this.handles.remove(\"view.floors\"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}highlight(e,t){return this._highlightGraphics.add(e),{remove:()=>{this._highlightGraphics.remove(e)}}}createFetchPopupFeaturesQueryGeometry(e,t){return l(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,floors:this.view.floors,...i})}};e([i()],f.prototype,\"strategy\",void 0),e([i()],f.prototype,\"updating\",void 0),f=e([s(\"esri.views.2d.layers.MapImageLayerView2D\")],f);const y=f;export{y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as p}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as l}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as m}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as c}from\"./support/popupUtils.js\";import{getLayerFloorFilterClause as u}from\"../support/floorFilterUtils.js\";const y=y=>{let d=class extends y{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const i=this.get(\"view.scale\"),p=[],m=async e=>{const r=0===e.minScale||i<=e.minScale,o=0===e.maxScale||i>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(m);else if(e.popupEnabled){const r=c(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&p.unshift({sublayer:e,popupTemplate:r})}},y=a.sublayers.toArray().reverse().map(m);await Promise.all(y);const d=p.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),i=t(s)?s.event:null,p=l({renderer:r.renderer,event:i}),m=this.createFetchPopupFeaturesQueryGeometry(e,p);if(a.geometry=m,a.outFields=await n(r,o),\"map-image\"===this.layer.type&&\"floors\"in this.view){var c,y;const e=null==(c=this.view)||null==(y=c.floors)?void 0:y.clone(),o=u(e,r);t(o)&&(a.where=a.where?`(${a.where}) AND (${o})`:o)}const d=await this._loadArcadeModules(o);d&&d.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=m.width/p);return(await r.queryFeatures(a)).features}));return(await o(d)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\")||Array.isArray(e.content)&&e.content.some((e=>\"expression\"===e.type)))return m()}};return e([s()],d.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],d.prototype,\"exportImageVersion\",null),e([s()],d.prototype,\"layer\",void 0),e([s()],d.prototype,\"suspended\",void 0),e([s(i)],d.prototype,\"timeExtent\",void 0),d=e([a(\"esri.views.layers.MapImageLayerView\")],d),d};export{y as MapImageLayerView,y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"names":["t","e","xoffset","Math","max","abs","yoffset","n","stops","length","r","s","size","filter","type","map","maxSize","minSize","o","f","floor","renderer","event","pointerType","visualVariables","symbol","uniqueValueInfos","forEach","classBreakInfos","drawPhase","this","attributeView","bindTextures","context","children","some","hasData","painter","effects","highlight","bind","setColorMask","clear","_renderChildren","defines","concat","draw","unbind","i","u","arguments","_highlightGraphics","a","strategy","update","catch","error","layer","imageMaxWidth","imageMaxHeight","version","_bitmapContainer","container","addChild","p","view","graphics","requestUpdateCallback","requestUpdate","m","featuresTilingScheme","fetchSource","fetchImage","imageRotationSupported","imageNormalizationSupported","hidpi","handles","add","watch","remove","destroy","removeAllChildren","l","updating","updateRequested","timeExtent","floors","y","d","exportImageParameters","commitProperty","_get","Promise","reject","get","minScale","maxScale","visible","sublayers","popupEnabled","c","defaultPopupTemplateEnabled","unshift","sublayer","popupTemplate","toArray","reverse","all","load","createQuery","createFetchPopupFeaturesQueryGeometry","geometry","outFields","clone","where","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","isEmpty","Array","isArray","content","prototype","readOnly","g","h","resolution","overlayPixelSizeInMapUnits","basemapSpatialReference","equals","spatialReference","x","xmin","min","ymin","xmax","ymax"],"sourceRoot":""}