"use strict";(self.webpackChunkcadastral=self.webpackChunkcadastral||[]).push([[2271],{96669:function(e,t,r){function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,n=0;n<e.length;n++){var a=e[n].size;"number"==typeof a&&(t+=a,r++)}return t/r}(e.stops):t}function i(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,n=t.minSize;return(a(r,e)+a(n,e))/2})),n=0,i=r.length;if(0===i)return e;for(var s=0;s<i;s++)n+=r[s];var o=Math.floor(n/i);return Math.max(o,e)}function s(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var a="visualVariables"in t?i(r,t.visualVariables):r;if("simple"===t.type)return n(a,t.symbol);if("unique-value"===t.type){var s=a;return t.uniqueValueInfos.forEach((function(e){s=n(s,e.symbol)})),s}if("class-breaks"===t.type){var o=a;return t.classBreakInfos.forEach((function(e){o=n(o,e.symbol)})),o}return t.type,a}r.d(t,{k:function(){return s}})},38229:function(e,t,r){r.r(t),r.d(t,{default:function(){return T}});var n=r(1413),a=r(15861),i=r(15671),s=r(43144),o=r(60136),u=r(29388),c=r(87757),h=r(27366),l=r(32718),p=r(66978),f=r(49861),d=(r(63780),r(93169),r(25243),r(69912)),y=r(78983),v=r(90110),m=r(95986),g=r(43634),x=r(11752),w=r(61120),b=(r(75366),r(80613)),k=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"renderChildren",value:function(e){if(e.drawPhase===b.jx.HIGHLIGHT&&(this.attributeView.bindTextures(e.context),this.children.some((function(e){return e.hasData})))){(0,x.Z)((0,w.Z)(r.prototype),"renderChildren",this).call(this,e);var t=e.painter.effects.highlight;t.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(16384),this._renderChildren(e,t.defines.concat(["highlightAll"])),t.draw(e),t.unbind()}}}]),r}(r(82022).Z),Z=k=(0,h._)([(0,d.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],k),C=r(9229),I=r(67581),_=r(93433),M=r(10064),P=r(92026),q=r(45948),V=r(44041),S=r(96669),E=r(819),U=r(24405),G=r(10141),R=r(13107),A=r(45008),F=l.Z.getLogger("esri.views.2d.layers.MapImageLayerView2D"),z=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments))._highlightGraphics=new y.J,e}return(0,s.Z)(r,[{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,p.D_)(e)||F.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxWidth,n=t.imageMaxHeight,a=t.version,i=a>=10.3,s=a>=10;this._bitmapContainer=new v.c,this.container.addChild(this._bitmapContainer);var o=new g.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new Z(this.view.featuresTilingScheme)});this.container.addChild(o.container),this.strategy=new C.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:r,imageMaxHeight:n,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.handles.add(this.watch("exportImageVersion",(function(){return e.requestUpdate()})),"exportImageVersion"),this.handles.add(this.watch("view.floors",(function(){return e.requestUpdate()})),"view.floors"),this.requestUpdate()}},{key:"detach",value:function(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"highlight",value:function(e,t){var r=this;return this._highlightGraphics.add(e),{remove:function(){r._highlightGraphics.remove(e)}}}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return(0,A.K)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=(0,a.Z)(c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,a){return this.layer.fetchImage(e,t,r,(0,n.Z)({timeExtent:this.timeExtent,floors:this.view.floors},a))}}]),r}(function(e){var t=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"initialize",value:function(){this.exportImageParameters=new V.R({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null==(e=this.exportImageParameters)||e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(){var e=(0,a.Z)(c.mark((function e(t,r){var i,s,o,u,h,l,f=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new M.Z("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:i})));case 3:return s=this.get("view.scale"),o=[],u=function(){var e=(0,a.Z)(c.mark((function e(t){var a,i,h;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0===t.minScale||s<=t.minScale,i=0===t.maxScale||s>=t.maxScale,t.visible&&a&&i&&(t.sublayers?t.sublayers.forEach(u):t.popupEnabled&&(h=(0,U.V)(t,(0,n.Z)((0,n.Z)({},r),{},{defaultPopupTemplateEnabled:!1})),(0,P.pC)(h)&&o.unshift({sublayer:t,popupTemplate:h})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=i.sublayers.toArray().reverse().map(u),e.next=6,Promise.all(h);case 6:return l=o.map(function(){var e=(0,a.Z)(c.mark((function e(n){var a,i,s,o,u,h,l,p,d,y,v;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.sublayer,i=n.popupTemplate,e.next=3,a.load().catch((function(){}));case 3:return s=a.createQuery(),o=(0,P.pC)(r)?r.event:null,u=(0,S.k)({renderer:a.renderer,event:o}),h=f.createFetchPopupFeaturesQueryGeometry(t,u),s.geometry=h,e.next=7,(0,U.e)(a,i);case 7:if(s.outFields=e.sent,"map-image"!==f.layer.type||!("floors"in f.view)){e.next=11;break}d=null==(l=f.view)||null==(p=l.floors)?void 0:p.clone(),y=(0,G.ff)(d,a),(0,P.pC)(y)&&(s.where=s.where?"(".concat(s.where,") AND (").concat(y,")"):y);case 11:return e.next=13,f._loadArcadeModules(i);case 13:return(v=e.sent)&&v.arcadeUtils.hasGeometryOperations(i)||(s.maxAllowableOffset=h.width/u),e.next=17,a.queryFeatures(s);case 17:return e.abrupt("return",e.sent.features);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=9,(0,p.as)(l);case 9:return e.abrupt("return",e.sent.reduce((function(e,t){return t.value?[].concat((0,_.Z)(e),(0,_.Z)(t.value)):e}),[]).filter((function(e){return null!=e})));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e;return!!(0,x.Z)((0,w.Z)(r.prototype),"canResume",this).call(this)&&(null==(e=this.timeExtent)||!e.isEmpty)}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,E.LC)()}}]),r}(e);return(0,h._)([(0,f.Cb)()],t.prototype,"exportImageParameters",void 0),(0,h._)([(0,f.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,h._)([(0,f.Cb)()],t.prototype,"layer",void 0),(0,h._)([(0,f.Cb)()],t.prototype,"suspended",void 0),(0,h._)([(0,f.Cb)(q.qG)],t.prototype,"timeExtent",void 0),t=(0,h._)([(0,d.j)("esri.views.layers.MapImageLayerView")],t)}((0,R.y)((0,m.y)(I.Z))));(0,h._)([(0,f.Cb)()],z.prototype,"strategy",void 0),(0,h._)([(0,f.Cb)()],z.prototype,"updating",void 0);var T=z=(0,h._)([(0,d.j)("esri.views.2d.layers.MapImageLayerView2D")],z)},45008:function(e,t,r){r.d(t,{K:function(){return s}});r(59486);var n=r(92026),a=r(68860),i=r(53866);function s(e,t,r){var s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new i.Z;if("2d"===r.type)s=t*r.resolution;else if("3d"===r.type){var u=r.overlayPixelSizeInMapUnits(e),c=r.basemapSpatialReference;s=(0,n.pC)(c)&&!c.equals(r.spatialReference)?(0,a.c9)(c)/(0,a.c9)(r.spatialReference):t*u}var h=e.x-s,l=e.y-s,p=e.x+s,f=e.y+s,d=r.spatialReference;return o.xmin=Math.min(h,p),o.ymin=Math.min(l,f),o.xmax=Math.max(h,p),o.ymax=Math.max(l,f),o.spatialReference=d,o}new i.Z}}]);
//# sourceMappingURL=2271.4036e5fd.chunk.js.map